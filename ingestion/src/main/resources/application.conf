# This is the main configuration file for our application, it provides overrides to the default values
# provided in the reference.conf of the modules from Akka
akka {
  actor {
    # Must be set like this to use Akka Cluster
    provider = cluster

    # Only for convenience in the quickstart, Java serialization should not be used for actual applications
    warn-about-java-serializer-usage = off


    //    serializers {
    //      java = "akka.serialization.JavaSerializer"
    //      kryo = "com.romix.akka.serialization.kryo.KryoSerializer"
    //    }
    //
    //    serialization-bindings {
    //      "utils.KryoSerializable" = kryo
    //    }

    //    kryo{
    //      type = "graph"
    //      idstrategy = "default"
    //      serializer-pool-size = 16
    //      buffer-size = 4096
    //      use-manifests = false
    //      implicit-registration-logging = false
    //      kryo-trace = false
    //    }

  }

  remote {
    maximum-payload-bytes = 100000000 bytes
    netty.tcp {
      message-frame-size = 100000000b
      send-buffer-size = 100000000b
      receive-buffer-size = 100000000b
      maximum-frame-size = 100000000b
    }
  }

  # Use slf4j (backed by logback) for logging, additional configuration
  # can be done in logback.xml
  loggers = ["akka.event.slf4j.Slf4jLogger"]
  logging-filter = "akka.event.slf4j.Slf4jLoggingFilter"
  loglevel = INFO

  # For the sample, just bind to loopback and do not allow access from the network
  remote.netty.tcp.hostname = 127.0.0.1
  # the port is overridden by the logic in Main.scala
  remote.netty.tcp.port = 0

  cluster {
    # Seed nodes are a way to have a node join the cluster (or form a new cluster) from configuration.
    seed-nodes = [
      "akka.tcp://ClusterSystem@127.0.0.1:2551",
      "akka.tcp://ClusterSystem@127.0.0.1:2552",
      "akka.tcp://ClusterSystem@127.0.0.1:2553",
      "akka.tcp://ClusterSystem@127.0.0.1:2554"]

    # Only for convenience in the quickstart, auto-downing should not be used for actual applications.
    # Read more here: http://doc.akka.io/docs/akka/current/scala/cluster-usage.html#auto-downing-do-not-use-
    auto-down-unreachable-after = 10s

    # Needed when running many actor systems in the same JVM
    jmx.multi-mbeans-in-same-jvm = on
  }

  # use Cassandra to store both snapshots and the events of the persistent actors
  persistence {
    journal.plugin = "cassandra-journal"
    snapshot-store.plugin = "cassandra-snapshot-store"
  }

  # Run the pubsub mediator on all nodes, without any code starting it up
  extensions = ["akka.cluster.pubsub.DistributedPubSub",
    "com.romix.akka.serialization.kryo.KryoSerializationExtension$"]


  http {
    server.parsing.illegal-header-warnings = off
    client.parsing.illegal-header-warnings = off
  }

}

# Configuration related to the app is in its own namespace
distributed-workers {
  # Each worker pings the master with this interval
  # to let it know that it is alive
  worker-registration-interval = 10s
  # If a worker hasn't gotten in touch in this long
  # it is removed from the set of workers
  consider-worker-dead-after = 60s
  # Must be shorter than all the source's work-timeout
  # recommended value is half of the minimum work-timeout
  clean-up-timeout = 10s

}


sources {

  copernicus {

    copernicus-oah-opensearch {

      description = "Copernicus Open Access Hub - OpenSearch"

      base-url = "https://scihub.copernicus.eu/dhus/search?"
      fetching-frequency = 20s
      epoch = 6 //years
      # Retry starts after x seconds of the previous try
      retry-interval = 3s
      # Retry stops after x seconds without response
      retry-timeout = 5s
      # If a workload hasn't finished in this long it
      # is considered failed and is retried
      work-timeout = 20s
      start-delay = 20s
      page-size = 10
      credentials {
        username = "andrelopes"
        pwd = "andrelopez14"
      }
      # The products that I am interested in
      # https://scihub.copernicus.eu/userguide/AdvancedSearch check product type for the syntax
      products = [
        {platform = "Sentinel2", product-type = "S2MSI1C"}//,
        //        {platform = "Sentinel2", product-type = "S2MSI2A"}
      ]

    }


    copernicus-oah-odata {

      description = "Copernicus Open Access Hub - OData"

      base-url = "https://scihub.copernicus.eu/dhus/odata/v1/"
      retry-interval = 3s
      # Retry stops after x seconds without response
      retry-timeout = 5s
      # If a workload hasn't finished in this long it
      # is considered failed and is retried
      work-timeout = 20s

      credentials {
        username = "andrelopes"
        pwd = "andrelopez14"
      }


      sentinel2 = {

        extractions = [
          {
            api = "copernicus-odata"
            name = "INSPIRE_Metadata"
            query-type = "file"
            result-type = "json"
            query = "$"
            doc-context = ""
            dest-path = "./data/(productId)/(filename)"
          }
          //          {
          //            api = "copernicus-odata"
          //            name = "md_metadata"
          //            query-type = "file"
          //            result-type = "xml"
          //            query = "/MD_Metadata/fileIdentifier"
          //            doc-context = "INSPIRE_Metadata"
          //            dest-path = "./data/(productId)/fileId.xml"
          //          },
          //          {
          //            api = "copernicus-odata"
          //            name = "INSPIRE_Metadata-publisher"
          //            query-type = "single-value"
          //            result-type = "string"
          //            query = "/MD_Metadata/fileIdentifier/CharacterString"
          //            doc-context = "INSPIRE_Metadata"
          //            dest-path = "./data/(productId)/publisher.xml"
          //          },
          //          {
          //            api = "copernicus-odata"
          //            name = "INSPIRE_Metadata-nodeset"
          //            query-type = "multi-file"
          //            result-type = "xml"
          //            query = "//keyword/CharacterString"
          //            doc-context = "INSPIRE_Metadata"
          //            dest-path = "./data/(productId)/multi-file-test.xml"
          //          },
          //          {
          //            api = "copernicus-odata"
          //            name = "keywords"
          //            query-type = "multi-value"
          //            result-type = "string"
          //            query = "//keyword/CharacterString"
          //            doc-context = "INSPIRE_Metadata"
          //            dest-path = "./data/(productId)/keywords.xml"
          //          }
          //          {
          //            api = "copernicus-odata"
          //            name = "Datastrips"
          //            query-type = "container"
          //            result-type = "undefined"
          //            query = ""
          //            doc-context = ""
          //            dest-path = ""
          //          }

        ]

      }

      S2MSI1C = {
        extractions = [
          //          {
          //            api = "copernicus-odata"
          //            name = "product-type"
          //            query-type = "single-value"
          //            result-type = "string"
          //            query = "/Level-1C_User_Product/General_Info/Product_Info/PRODUCT_TYPE"
          //            doc-context = "S2_Level-1C_Product_Metadata"
          //            dest-path = "./data/(productId)/product-type.xml"
          //          },
          //          {
          //            api = "copernicus-odata"
          //            name = "processing-level"
          //            query-type = "single-value"
          //            result-type = "string"
          //            query = "/Level-1C_User_Product/General_Info/Product_Info/PROCESSING_LEVEL"
          //            doc-context = "S2_Level-1C_Product_Metadata"
          //            dest-path = "./data/(productId)/processing-level.xml"
          //          },
          //          {
          //            api = "copernicus-odata"
          //            name = "processing-level"
          //            query-type = "single-value"
          //            result-type = "string"
          //            query = "/Level-1C_User_Product/General_Info/Product_Info/PROCESSING_LEVEL"
          //            doc-context = "S2_Level-1C_Product_Metadata"
          //            dest-path = "./data/(productId)/processing-level.xml"
          //          },
          //          {
          //            api = "copernicus-odata"
          //            name = "datatakeId"
          //            query-type = "single-value"
          //            result-type = "string"
          //            query = "/Level-1C_User_Product/General_Info/Product_Info/Datatake/@datatakeIdentifier"
          //            doc-context = "S2_Level-1C_Product_Metadata"
          //            dest-path = "./data/(productId)/datatakeId.xml"
          //          },
          //          {
          //            api = "copernicus-odata"
          //            name = "platform"
          //            query-type = "single-value"
          //            result-type = "string"
          //            query = "/Level-1C_User_Product/General_Info/Product_Info/Datatake/SPACECRAFT_NAME"
          //            doc-context = "S2_Level-1C_Product_Metadata"
          //            dest-path = "./data/(productId)/platform.xml"
          //          },
          //          {
          //            api = "copernicus-odata"
          //            name = "orbit-number"
          //            query-type = "single-value"
          //            result-type = "string"
          //            query = "/Level-1C_User_Product/General_Info/Product_Info/Datatake/SENSING_ORBIT_NUMBER"
          //            doc-context = "S2_Level-1C_Product_Metadata"
          //            dest-path = "./data/(productId)/orbit-number.xml"
          //          },
          //          {
          //            api = "copernicus-odata"
          //            name = "datatake-sensing-start"
          //            query-type = "single-value"
          //            result-type = "string"
          //            query = "/Level-1C_User_Product/General_Info/Product_Info/Datatake/DATATAKE_SENSING_START"
          //            doc-context = "S2_Level-1C_Product_Metadata"
          //            dest-path = "./data/(productId)/datatake-sensing-start.xml"
          //          },
          //          {
          //            api = "copernicus-odata"
          //            name = "datatake-type"
          //            query-type = "single-value"
          //            result-type = "string"
          //            query = "/Level-1C_User_Product/General_Info/Product_Info/Datatake/DATATAKE_TYPE"
          //            doc-context = "S2_Level-1C_Product_Metadata"
          //            dest-path = "./data/(productId)/datatake-type.xml"
          //          },
          //          {
          //            api = "copernicus-odata"
          //            name = "cloud-coverage"
          //            query-type = "single-value"
          //            result-type = "string"
          //            query = "/Level-1C_User_Product/Quality_Indicators_Info/Cloud_Coverage_Assessment"
          //            doc-context = "S2_Level-1C_Product_Metadata"
          //            dest-path = "./data/(productId)/cloud-coverage.xml"
          //          },
          //          {
          //            api = "copernicus-odata"
          //            name = "footprint"
          //            query-type = "single-value"
          //            result-type = "string"
          //            query = "/Level-1C_User_Product/Geometric_Info/Product_Footprint/Product_Footprint/Global_Footprint/EXT_POS_LIST"
          //            doc-context = "S2_Level-1C_Product_Metadata"
          //            dest-path = "./data/(productId)/footprint.xml"
          //          }
          //          {
          //            api = "copernicus-odata"
          //            name = "QI_DATA_Tile1"
          //            query-type = "container"
          //            result-type = "undefined"
          //            query = ""
          //            doc-context = ""
          //            dest-path = ""
          //          }

        ]
      }

      S2MSI2A = {
        extractions = []
      }

    }
  }


  creodias {
    creodias-odata {

      description = "CREODIAS - OData"

      base-url = "https://finder.creodias.eu/resto/api/collections"
      retry-interval = 3s
      # Retry stops after x seconds without response
      retry-timeout = 5s
      # If a workload hasn't finished in this long it
      # is considered failed and is retried
      work-timeout = 20s

      extractions = [
        {
          api = "creodias-odata"
          name = "keywords"
          query-type = "multi-file"
          result-type = "json"
          query = "$.features[0].properties.keywords[*]"
          doc-context = "creodias-file"
          dest-path = "./data/(productId)/keywords-multi-file.json"
        },
        {
          api = "creodias-odata"
          name = "properties"
          query-type = "file"
          result-type = "json"
          query = "$.properties"
          doc-context = "creodias-file"
          dest-path = "./data/(productId)/properties.json"
        },
        {
          api = "creodias-odata"
          name = "keywords-multi-value"
          query-type = "multi-value"
          result-type = "object"
          query = "$.features[0].properties.keywords[*]"
          doc-context = "creodias-file"
          dest-path = "./data/(productId)/keywords-multi-value.json"
        },
        {
          api = "creodias-odata"
          name = "keywords-name"
          query-type = "multi-value"
          result-type = "string"
          query = "$.features[0].properties.keywords[*].value"
          doc-context = "creodias-file"
          dest-path = "./data/(productId)/keywords-value.json"
        },
        {
          api = "creodias-odata"
          name = "keywords-single-value"
          query-type = "single-value"
          result-type = "object"
          query = "$.features[0].properties.keywords[0]"
          doc-context = "creodias-file"
          dest-path = "./data/(productId)/keywords-single-value.json"
        },
        {
          api = "creodias-odata"
          name = "totalResults"
          query-type = "single-value"
          result-type = "int"
          query = "$.properties.totalResults"
          doc-context = "creodias-file"
          dest-path = "./data/(productId)/totalResults.json"
        },
        {
          api = "creodias-odata"
          name = "exactCount"
          query-type = "single-value"
          result-type = "boolean"
          query = "$.properties.exactCount"
          doc-context = "creodias-file"
          dest-path = "./data/(productId)/exactCount.json"
        },
        {
          api = "creodias-odata"
          name = "processingTime"
          query-type = "single-value"
          result-type = "float"
          query = "$.properties.query.processingTime"
          doc-context = "creodias-file"
          dest-path = "./data/(productId)/processingTime.json"
        },
        {
          api = "creodias-odata"
          name = "collection"
          query-type = "single-value"
          result-type = "string"
          query = "$.features[0].properties.collection"
          doc-context = "creodias-file"
          dest-path = "./data/(productId)/collection.json"
        }

      ]

    }
  }
}
